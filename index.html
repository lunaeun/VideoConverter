<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ¬ Video Converter</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}

body{
    font-family:'Segoe UI',-apple-system,BlinkMacSystemFont,'Malgun Gothic',sans-serif;
    background:#f0f2f5;
    min-height:100vh;
    color:#333;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:20px;
}

/* â”€â”€ ë©”ì¸ ì¹´ë“œ â”€â”€ */
.app{
    max-width:680px;
    width:100%;
    background:#ffffff;
    border-radius:24px;
    padding:40px;
    box-shadow:0 4px 24px rgba(0,0,0,0.06), 0 1px 4px rgba(0,0,0,0.04);
    border:1px solid #e8eaed;
}

/* â”€â”€ í—¤ë” â”€â”€ */
.hdr{text-align:center;margin-bottom:30px}
.hdr-icon{font-size:48px;margin-bottom:8px;display:block}
.hdr h1{
    font-size:24px;
    font-weight:800;
    color:#1a1a2e;
    margin-bottom:6px;
}
.hdr p{color:#888;font-size:13px;line-height:1.6}
.badge{
    display:inline-flex;gap:6px;margin-top:12px;
    padding:6px 16px;background:#f5f0ff;
    border:1px solid #e4d9fc;border-radius:50px;
    font-size:11px;color:#7c6bae;
}
.badge b{color:#6c4dc4}

/* â”€â”€ ë„êµ¬ ìƒíƒœ â”€â”€ */
.tool-status{display:flex;gap:8px;justify-content:center;margin:14px 0 0;flex-wrap:wrap}
.ts{
    font-size:11px;padding:4px 12px;border-radius:20px;font-weight:600;
    border:1px solid #e0e0e0;
}
.ts.ok{border-color:#c8f7dc;color:#1b874b;background:#edfff4}
.ts.no{border-color:#fdd;color:#c0392b;background:#fff5f5}

/* â”€â”€ í¼ â”€â”€ */
label{
    display:block;margin-bottom:7px;font-size:12px;
    font-weight:700;color:#666;text-transform:uppercase;letter-spacing:1px;
}
input[type="text"]{
    width:100%;padding:14px 16px;
    background:#fafbfc;border:1.5px solid #dde1e6;
    border-radius:12px;color:#333;font-size:14px;
    outline:none;transition:all .3s;font-family:inherit;
}
input[type="text"]:focus{
    border-color:#6c4dc4;
    box-shadow:0 0 0 3px rgba(108,77,196,0.1);
    background:#fff;
}
input[type="text"]::placeholder{color:#bbb}

select{
    width:100%;padding:14px 16px;
    background:#fafbfc;border:1.5px solid #dde1e6;
    border-radius:12px;color:#333;font-size:14px;
    outline:none;transition:all .3s;font-family:inherit;
    cursor:pointer;
    -webkit-appearance:none;appearance:none;
    background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%23999' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10z'/%3E%3C/svg%3E");
    background-repeat:no-repeat;
    background-position:right 14px center;
}
select:focus{
    border-color:#6c4dc4;
    box-shadow:0 0 0 3px rgba(108,77,196,0.1);
}
select option{background:#fff;color:#333}

.fg{margin-bottom:20px}
.row2{display:grid;grid-template-columns:1fr 1fr;gap:14px}

/* â”€â”€ ì½”ë± ì¹´ë“œ â”€â”€ */
.codecs{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:22px}
.cc{
    padding:14px 8px;text-align:center;border-radius:12px;cursor:pointer;
    background:#fafbfc;border:2px solid #e8eaed;
    transition:all .25s;
}
.cc:hover{border-color:#c9b8f0;background:#f9f5ff}
.cc.on{
    border-color:#6c4dc4;background:#f5f0ff;
    box-shadow:0 2px 12px rgba(108,77,196,0.12);
}
.cc .cn{font-size:14px;font-weight:700;color:#555}
.cc.on .cn{color:#6c4dc4}
.cc .cd{font-size:10px;color:#999;margin-top:3px}
.cc.on .cd{color:#8b7bb8}

/* â”€â”€ ìŠ¬ë¼ì´ë” â”€â”€ */
.qbox{
    text-align:center;background:#fafbfc;
    border:1.5px solid #e8eaed;border-radius:14px;padding:16px;
}
.qval{
    font-size:34px;font-weight:800;
    color:#6c4dc4;
    line-height:1;margin:4px 0;
}
input[type="range"]{
    width:100%;-webkit-appearance:none;height:6px;border-radius:3px;
    background:linear-gradient(90deg,#6c4dc4,#a78bfa,#c084fc);
    outline:none;margin-top:10px;opacity:0.85;
}
input[type="range"]:hover{opacity:1}
input[type="range"]::-webkit-slider-thumb{
    -webkit-appearance:none;width:22px;height:22px;border-radius:50%;
    background:#fff;cursor:pointer;
    box-shadow:0 1px 6px rgba(0,0,0,0.15), 0 0 0 3px rgba(108,77,196,0.2);
    transition:transform 0.2s;
}
input[type="range"]::-webkit-slider-thumb:hover{transform:scale(1.1)}
.qhint{font-size:10px;color:#aaa;margin-top:8px}

/* â”€â”€ ì‹œì‘ ë²„íŠ¼ â”€â”€ */
.btn{
    width:100%;padding:16px;border:none;border-radius:14px;
    font-size:15px;font-weight:700;cursor:pointer;
    background:linear-gradient(135deg,#6c4dc4,#8b6ce0);
    color:#fff;transition:all .3s;
    text-transform:uppercase;letter-spacing:1px;
    font-family:inherit;margin-top:8px;
    box-shadow:0 4px 15px rgba(108,77,196,0.25);
}
.btn:hover{
    transform:translateY(-2px);
    box-shadow:0 8px 25px rgba(108,77,196,0.35);
}
.btn:disabled{
    opacity:0.5;cursor:not-allowed;
    transform:none!important;box-shadow:none!important;
    background:#ccc;
}

/* â”€â”€ ì§„í–‰ ìƒíƒœ â”€â”€ */
.prog{display:none;margin-top:28px;animation:fi .4s}
.prog.on{display:block}
@keyframes fi{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}

/* ìŠ¤í… */
.steps{display:flex;justify-content:space-between;margin-bottom:24px;position:relative;padding:0 5px}
.sline{
    position:absolute;top:24px;left:55px;right:55px;
    height:3px;background:#e8eaed;border-radius:2px;
}
.sline-fill{
    height:100%;border-radius:2px;width:0%;
    background:linear-gradient(90deg,#6c4dc4,#a78bfa);
    transition:width .8s;
}
.stp{text-align:center;flex:1;position:relative;z-index:1}
.sc{
    width:50px;height:50px;border-radius:50%;margin:0 auto 10px;
    display:flex;align-items:center;justify-content:center;font-size:20px;
    background:#f5f5f5;border:2.5px solid #e0e0e0;
    transition:all .5s;
}
.stp.act .sc{
    background:#f0ebff;border-color:#6c4dc4;
    box-shadow:0 0 0 6px rgba(108,77,196,0.1);
    animation:sp 2s infinite;
}
.stp.done .sc{
    background:#edfff4;border-color:#27ae60;
    box-shadow:0 0 0 6px rgba(39,174,96,0.08);
    animation:none;
}
@keyframes sp{
    0%,100%{box-shadow:0 0 0 6px rgba(108,77,196,0.08)}
    50%{box-shadow:0 0 0 10px rgba(108,77,196,0.15)}
}
.sl{font-size:11px;color:#999;font-weight:700;text-transform:uppercase;letter-spacing:.5px}
.stp.act .sl{color:#6c4dc4}
.stp.done .sl{color:#27ae60}

/* í”„ë¡œê·¸ë ˆìŠ¤ ë°” */
.pw{margin-bottom:12px}
.ph{display:flex;justify-content:space-between;margin-bottom:8px}
.ph span:first-child{font-size:12px;color:#999;font-weight:600}
.ph span:last-child{font-size:14px;font-weight:800;color:#6c4dc4}
.po{background:#eeeff2;border-radius:10px;height:14px;overflow:hidden}
.pb{
    height:100%;border-radius:10px;width:0%;
    background:linear-gradient(90deg,#6c4dc4,#a78bfa,#c084fc);
    background-size:300% 100%;
    animation:bs 3s linear infinite;
    transition:width .5s;
}
@keyframes bs{0%{background-position:300% 0}100%{background-position:-300% 0}}

/* ìƒíƒœ ë©”ì‹œì§€ */
.sm{text-align:center;color:#888;font-size:13px;margin-top:12px;min-height:22px}
.spin{
    display:inline-block;width:14px;height:14px;
    border:2.5px solid #e0d5f7;border-top-color:#6c4dc4;
    border-radius:50%;animation:spin .7s linear infinite;
    vertical-align:middle;margin-right:6px;
}
@keyframes spin{to{transform:rotate(360deg)}}

/* â”€â”€ ê²°ê³¼ â”€â”€ */
.result{display:none;margin-top:24px;animation:fi .5s}
.result.on{display:block}
.rcard{
    background:#f0fdf4;
    border:1.5px solid #bbf7d0;
    border-radius:18px;padding:30px;text-align:center;
}
.rcard .ri{font-size:48px;margin-bottom:8px;display:block}
.rcard .rt{font-size:20px;font-weight:800;color:#16a34a}
.rcard .rs{font-size:30px;font-weight:800;color:#333;margin:12px 0 4px}
.rcard .rsl{font-size:10px;color:#999;text-transform:uppercase;letter-spacing:1px}

.bdl{
    display:inline-block;margin-top:16px;padding:14px 44px;
    border-radius:12px;font-size:15px;font-weight:700;
    background:linear-gradient(135deg,#16a34a,#22c55e);color:#fff;
    text-decoration:none;transition:all .3s;
    box-shadow:0 4px 15px rgba(22,163,74,0.25);
}
.bdl:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(22,163,74,0.3)}
.bnew{
    display:inline-block;margin-top:12px;padding:10px 24px;
    border:1.5px solid #dde1e6;border-radius:10px;
    font-size:12px;color:#888;cursor:pointer;background:#fff;
    transition:all .3s;font-family:inherit;font-weight:600;
}
.bnew:hover{border-color:#6c4dc4;color:#6c4dc4;background:#f9f5ff}

/* â”€â”€ ì—ëŸ¬ â”€â”€ */
.err{
    display:none;margin-top:16px;padding:14px 18px;text-align:center;
    background:#fff5f5;border:1.5px solid #fecaca;
    border-radius:12px;color:#dc2626;font-size:13px;font-weight:500;
}
.err.on{display:block}

/* â”€â”€ ì•ˆë‚´ â”€â”€ */
.info{
    margin-top:24px;padding:16px 20px;font-size:12px;color:#999;line-height:2;
    background:#fafbfc;border:1px solid #e8eaed;
    border-radius:14px;
}
.info b{color:#666}
.info code{
    background:#f0ebff;padding:2px 8px;border-radius:6px;
    font-size:11px;color:#6c4dc4;font-weight:600;
}

/* â”€â”€ êµ¬ë¶„ì„  â”€â”€ */
.divider{
    height:1px;background:#eee;margin:20px 0;
}

/* â”€â”€ ë°˜ì‘í˜• â”€â”€ */
@media(max-width:600px){
    .app{padding:24px 18px;border-radius:18px}
    .codecs{grid-template-columns:repeat(2,1fr)}
    .row2{grid-template-columns:1fr}
    .hdr h1{font-size:20px}
}
</style>
</head>
<body>
<div class="app">

    <!-- í—¤ë” -->
    <div class="hdr">
        <span class="hdr-icon">ğŸ¬</span>
        <h1>Video Converter</h1>
        <p>ë™ì˜ìƒ URLì„ ì…ë ¥í•˜ë©´ ìë™ìœ¼ë¡œ<br>720p ë‹¤ìš´ë¡œë“œ â†’ 1080p ì—…ìŠ¤ì¼€ì¼ â†’ ì½”ë± ë³€í™˜</p>
        <div class="badge"><b>yt-dlp</b> â†’ <b>FFmpeg</b> â†’ <b>HandBrake</b></div>
        <div class="tool-status" id="toolStatus"></div>
    </div>

    <div class="divider"></div>

    <!-- URL ì…ë ¥ -->
    <div class="fg">
        <label>ğŸ”— ë™ì˜ìƒ URL</label>
        <input type="text" id="url" placeholder="https://youtube.com/watch?v=... ë“± URLì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”">
    </div>

    <!-- ì½”ë± ì„ íƒ -->
    <div class="fg">
        <label>ğŸï¸ ì¶œë ¥ ì½”ë±</label>
        <div class="codecs" id="codecs">
            <div class="cc on" data-v="x265" onclick="pickCodec(this)">
                <div class="cn">H.265</div>
                <div class="cd">HEVC ê³ ì••ì¶•</div>
            </div>
            <div class="cc" data-v="x264" onclick="pickCodec(this)">
                <div class="cn">H.264</div>
                <div class="cd">AVC í˜¸í™˜</div>
            </div>
            <div class="cc" data-v="SVT-AV1" onclick="pickCodec(this)">
                <div class="cn">AV1</div>
                <div class="cd">ìµœì‹  í‘œì¤€</div>
            </div>
            <div class="cc" data-v="VP9" onclick="pickCodec(this)">
                <div class="cn">VP9</div>
                <div class="cd">WebM</div>
            </div>
        </div>
    </div>

    <!-- ì˜µì…˜ -->
    <div class="row2">
        <div class="fg">
            <label>âš¡ ì†ë„ í”„ë¦¬ì…‹</label>
            <select id="preset">
                <option value="ultrafast">ì´ˆê³ ì†</option>
                <option value="fast">ë¹ ë¦„</option>
                <option value="medium" selected>ë³´í†µ (ê¶Œì¥)</option>
                <option value="slow">ê³ í’ˆì§ˆ (ëŠë¦¼)</option>
            </select>
        </div>
        <div class="fg">
            <div class="qbox">
                <label>âœ¨ í’ˆì§ˆ (RF)</label>
                <div class="qval" id="qd">22</div>
                <input type="range" id="quality" min="15" max="35" value="22"
                       oninput="document.getElementById('qd').textContent=this.value">
                <div class="qhint">â† ê³ í’ˆì§ˆ &nbsp;&nbsp;&nbsp; ì €ìš©ëŸ‰ â†’</div>
            </div>
        </div>
    </div>

    <!-- ì‹œì‘ ë²„íŠ¼ -->
    <button class="btn" id="btnGo" onclick="go()">ğŸš€ ë‹¤ìš´ë¡œë“œ & ë³€í™˜ ì‹œì‘</button>

    <!-- ì—ëŸ¬ -->
    <div class="err" id="err"></div>

    <!-- ì§„í–‰ ìƒíƒœ -->
    <div class="prog" id="prog">
        <div class="steps">
            <div class="sline"><div class="sline-fill" id="sf"></div></div>
            <div class="stp" id="s1"><div class="sc">ğŸ“¥</div><div class="sl">ë‹¤ìš´ë¡œë“œ</div></div>
            <div class="stp" id="s2"><div class="sc">ğŸ”„</div><div class="sl">ì—…ìŠ¤ì¼€ì¼</div></div>
            <div class="stp" id="s3"><div class="sc">ğŸ¯</div><div class="sl">ì½”ë±ë³€í™˜</div></div>
        </div>
        <div class="pw">
            <div class="ph"><span>ì§„í–‰ë¥ </span><span id="pct">0%</span></div>
            <div class="po"><div class="pb" id="pb"></div></div>
        </div>
        <div class="sm" id="sm"><span class="spin"></span> ì¤€ë¹„ ì¤‘...</div>
    </div>

    <!-- ê²°ê³¼ -->
    <div class="result" id="result">
        <div class="rcard">
            <span class="ri">âœ…</span>
            <div class="rt">ë³€í™˜ ì™„ë£Œ!</div>
            <div class="rs" id="fsize">-</div>
            <div class="rsl">íŒŒì¼ í¬ê¸°</div>
            <br>
            <a class="bdl" id="dlLink" href="#">ğŸ“ ë‹¤ìš´ë¡œë“œ</a>
            <br>
            <button class="bnew" onclick="reset()">ğŸ”„ ìƒˆ ì‘ì—… ì‹œì‘</button>
        </div>
    </div>

    <div class="divider"></div>

    <!-- ì•ˆë‚´ -->
    <div class="info">
        <b>ì•ˆë‚´:</b> ìµœëŒ€ <b>10ë¶„</b> ì´í•˜ ì˜ìƒë§Œ ì²˜ë¦¬ ê°€ëŠ¥í•©ë‹ˆë‹¤.<br>
        <b>íŒŒì´í”„ë¼ì¸:</b> <code>yt-dlp</code> 720p â†’ <code>FFmpeg</code> 1080p â†’ <code>HandBrakeCLI</code> ì½”ë±ë³€í™˜
    </div>
</div>

<script>
let codec="x265",taskId=null,poll=null;

// ë„êµ¬ ìƒíƒœ ì²´í¬
fetch('/api/check').then(r=>r.json()).then(d=>{
    const el=document.getElementById('toolStatus');
    const items=[
        ['Python',d.python],['yt-dlp',d.ytdlp],
        ['FFmpeg',d.ffmpeg],['HandBrake',d.handbrake]
    ];
    el.innerHTML=items.map(([n,ok])=>
        `<span class="ts ${ok?'ok':'no'}">${ok?'âœ“':'âœ—'} ${n}</span>`
    ).join('');
}).catch(()=>{});

function pickCodec(el){
    document.querySelectorAll('.cc').forEach(c=>c.classList.remove('on'));
    el.classList.add('on');
    codec=el.dataset.v;
}

function go(){
    const url=document.getElementById('url').value.trim();
    if(!url)return showErr('URLì„ ì…ë ¥í•˜ì„¸ìš”.');
    hideErr();
    document.getElementById('btnGo').disabled=true;
    document.getElementById('btnGo').textContent='â³ ì²˜ë¦¬ ì¤‘...';
    document.getElementById('prog').classList.add('on');
    document.getElementById('result').classList.remove('on');
    resetSteps();

    fetch('/api/start',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({
            url, codec,
            quality:+document.getElementById('quality').value,
            preset:document.getElementById('preset').value
        })
    }).then(r=>r.json()).then(d=>{
        if(d.error){showErr(d.error);resetBtn();return}
        taskId=d.task_id;
        poll=setInterval(check,1200);
    }).catch(e=>{showErr('ì„œë²„ ì˜¤ë¥˜: '+e.message);resetBtn()});
}

function check(){
    if(!taskId)return;
    fetch('/api/status/'+taskId).then(r=>r.json()).then(d=>{
        if(d.error){showErr(d.error);clearInterval(poll);resetBtn();return}
        const step=d.step||0;
        const done=d.status==='completed';
        setSteps(step,done);
        const p=Math.max(0,d.progress||0);
        if(p>0){
            document.getElementById('pb').style.width=p+'%';
            document.getElementById('pct').textContent=p.toFixed(1)+'%';
        }
        document.getElementById('sm').innerHTML='<span class="spin"></span> '+(d.message||'ì²˜ë¦¬ ì¤‘...');
        if(done){
            clearInterval(poll);
            document.getElementById('pb').style.width='100%';
            document.getElementById('pct').textContent='100%';
            document.getElementById('sm').innerHTML='ğŸ‰ '+d.message;
            document.getElementById('fsize').textContent=d.file_size+' MB';
            document.getElementById('dlLink').href='/api/download/'+taskId;
            document.getElementById('result').classList.add('on');
            resetBtn();
        }
        if(d.status==='error'){
            clearInterval(poll);showErr(d.message);resetBtn();
        }
    }).catch(()=>{});
}

function setSteps(cur,done){
    for(let i=1;i<=3;i++){
        const el=document.getElementById('s'+i);
        el.classList.remove('act','done');
        if(done)el.classList.add('done');
        else if(i<cur)el.classList.add('done');
        else if(i===cur)el.classList.add('act');
    }
    document.getElementById('sf').style.width=(done?100:Math.max(0,(cur-1)*50))+'%';
}

function resetSteps(){
    for(let i=1;i<=3;i++)document.getElementById('s'+i).classList.remove('act','done');
    document.getElementById('sf').style.width='0%';
    document.getElementById('pb').style.width='0%';
    document.getElementById('pct').textContent='0%';
}

function showErr(m){const e=document.getElementById('err');e.textContent=m;e.classList.add('on')}
function hideErr(){document.getElementById('err').classList.remove('on')}
function resetBtn(){
    document.getElementById('btnGo').disabled=false;
    document.getElementById('btnGo').textContent='ğŸš€ ë‹¤ìš´ë¡œë“œ & ë³€í™˜ ì‹œì‘';
}
function reset(){
    document.getElementById('prog').classList.remove('on');
    document.getElementById('result').classList.remove('on');
    document.getElementById('url').value='';
    hideErr();resetSteps();resetBtn();
}
document.getElementById('url').addEventListener('keydown',e=>{if(e.key==='Enter')go()});
</script>
</body>
</html>
